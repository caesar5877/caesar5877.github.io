APIæ˜¯æ‰€æœ‰åé¢å†…å®¹çš„æ ¹ã€‚ æ‰€ä»¥APIçš„å®šä¹‰ä¸€å®šè¦åšå¥½ã€‚

ä¸‹é¢ç»™ä½ ä¸€ä¸ª **â€œä»»ä½•ç³»ç»Ÿéƒ½é€šç”¨ã€é¢è¯•å®˜æœ€å–œæ¬¢ã€æœ€å¿«æ¸…æ™°é”å®š Functional Requirements çš„æé—®æ¡†æ¶â€**ã€‚

è¿™æ˜¯ä¸€ä¸ª **é€šç”¨æé—®æ¸…å•ï¼ˆGeneral Discovery Questionsï¼‰**ï¼Œæ— è®ºæ˜¯ ride-sharingã€Instagramã€payment systemã€rate limiterã€collaboration docã€food deliveryï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

æˆ‘æŠŠè¿™äº›é—®é¢˜æ•´ç†æˆ **5 å¤§ç±»ã€15 ä¸ªé»„é‡‘é—®é¢˜**ï¼Œè¶³å¤Ÿè®©ä½ è¿…é€Ÿæ‘¸é€é¢è¯•å®˜çš„é¢„æœŸï¼ŒåŒæ—¶æ˜¾å¾—ä½ éå¸¸ seniorã€‚

---

### **ç³»ç»Ÿè®¾è®¡é¢è¯•ï¼š5 å¤§ç±»ã€15 ä¸ªä¸‡èƒ½æé—®ï¼ˆFunctional Requirements Discoveryï¼‰**

#### **(A) æ ¸å¿ƒç”¨æˆ·ä¸ç›®æ ‡ï¼ˆå¿…é—®ï¼‰**

1. **Who are the primary users?**
   â†’ ç”¨æˆ·è§’è‰²ä¸åŒï¼ŒåŠŸèƒ½å¿…ç„¶ä¸åŒï¼ˆä¹˜å®¢ vs å¸æœºã€å•†å®¶ vs é¡¾å®¢ã€å†…éƒ¨ vs å¤–éƒ¨ APIï¼‰

2. **What is the single most important outcome the system must achieve?**
   â†’ Surface æœ€å…³é”® FRï¼ˆå¦‚ real-time matchã€secure paymentã€low-latency feedï¼‰

---

#### **(B) æ ¸å¿ƒåŠ¨ä½œã€å…³é”®æµç¨‹ï¼ˆå¿…é—®ï¼‰**

3. **What are the main user actions or workflows?**
   â†’ ç›´æ¥è®©é¢è¯•å®˜åˆ— FRï¼ˆe.g., search, upload, match, publishï¼‰

4. **What triggers each workflow? User-initiated or system-generated?**
   â†’ åˆ¤æ–­æ˜¯åŒæ­¥æµç¨‹è¿˜æ˜¯å¼‚æ­¥äº‹ä»¶é©±åŠ¨

5. **What must happen synchronously vs. asynchronously?**
   â†’ å¸®åŠ©ä½ ç¡®å®š API vs queue vs event design

---

#### **(C) è¾“å…¥ã€è¾“å‡ºã€æ•°æ®èŒƒå›´ï¼ˆæœ€é‡è¦ï¼‰**

6. **What input data do we receive, and from whom?**
   â†’ è¾“å…¥å†³å®šæ•°æ®æ¨¡å‹

7. **What output do we return, and to whom?**
   â†’ å†³å®š API responses & consumer needs

8. **How fresh or real-time must the data be?**
   â†’ Functional requirementï¼Œä½†ä¼šå½±å“ NFRï¼ˆlatency, consistencyï¼‰

9. **How large is the data we store or process?**
   â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦ shardingã€partitioningã€cacheã€streaming

---

#### **(D) åŠŸèƒ½è¾¹ç•Œï¼ˆåŠŸèƒ½èŒƒå›´ vs ä¸åšä»€ä¹ˆï¼‰**

10. **What is in scope and what is explicitly out of scope?**
    â†’ è¿™æ˜¯ Staff-level questionï¼›é¿å… over-engineeringã€‚

11. **Should we handle failures or retries on behalf of the client?**
    â†’ FR å†³å®šï¼šauto retryï¼Ÿmanual retryï¼Ÿidempotent APIï¼Ÿ

12. **Do we need to support history, auditing, or versioning?**
    â†’ æ—¶é—´çº¿æ•°æ®ï¼ˆtimelineï¼‰ã€ç‰ˆæœ¬æ§åˆ¶ï¼ˆdocsï¼‰ã€transaction historyï¼ˆpaymentï¼‰

---

#### **(E) æˆåŠŸæ ‡å‡†ä¸ç³»ç»Ÿç›®æ ‡ï¼ˆç»ˆå±€è¦æ±‚ï¼‰**

13. **What defines a successful operation from the userâ€™s perspective?**
    â†’ e.g., "status updates within 1 sec" æˆ– "search results must be relevant"

14. **Are there SLAs for specific workflows?**
    â†’ è¿™æ˜¯ â€œFunctional requirement disguised as NFRâ€

15. **What are the edge cases the system must explicitly handle?**
    â†’ ç³»ç»Ÿè¾¹ç•Œã€å¼‚å¸¸è·¯å¾„ã€å¹¶å‘å†²çªï¼Œç”¨æˆ·ä¸ç†Ÿç»ƒé—®ä¸å‡ºè¿™ä¸ªé—®é¢˜ã€‚

---

###  **15 ä¸ªé—®é¢˜æµ“ç¼©æˆä¸€ä¸ªè¶…çº§æ¨¡æ¿ï¼ˆä¾›é¢è¯•ç›´æ¥å¼€å£ï¼‰**

ä½ å¯ä»¥åœ¨é¢è¯•å¼€å§‹æ—¶è‡ªç„¶è¯´å‡ºæ¥ï¼š

* â€œBefore diving into the architecture, Iâ€™d like to clarify the functional expectations.
* To ensure I fully understand the problem, could you help me with a few points:
* 1 who the primary users are,
* 2 what core workflows they need,
* 3 what inputs/outputs the system handles,
* 4 whatâ€™s in scope vs out of scope,
* 5 and any success criteria or SLAs we should meet?â€

è¿™æ®µè¯éå¸¸æ ‡å‡†ï¼Œè¯­æ°”é«˜çº§ï¼Œä¿¡æ¯ç»“æ„åŒ–ï¼Œé¢è¯•å®˜éƒ½ä¼šç‚¹å¤´ã€‚

---

### è¡¥å……ï¼šå¦‚æœé¢è¯•å®˜ä¸ç»™ FRï¼Œä½ å¯ä»¥åå‘ç»™ Options

ä¾‹å¦‚è®¾è®¡ ride-sharingï¼š

ä½ å¯ä»¥é—®ï¼š

* 1 â€œDo we need to support both passengers and drivers?â€
* 2 â€œShould I focus on matching, realtime location, or the full lifecycle including payment?â€

å¦‚æœæ˜¯è®¾è®¡ Instagram Feedï¼š

* â€œShould we support photo, video, or both?â€
* â€œAre we designing just the feed ranking, or also publishing?â€

åå‘ç»™é€‰é¡¹ = æ˜¾ç¤ºä½ ç†Ÿæ‚‰ domain + è®©é¢è¯•å®˜ç¡®è®¤èŒƒå›´ã€‚

---

###  æœ€åé€ä½ ä¸€å¥ä¸‡èƒ½å£è¯€ï¼ˆä»»ä½•ç³»ç»Ÿçš„ FR éƒ½ç”±è¿™ä¸‰ä»¶äº‹æ„æˆï¼‰

* **äºº â†’ åšä»€ä¹ˆ â†’ ç”¨ä»€ä¹ˆæ•°æ®**
* (Users â†’ Actions â†’ Data)

å¦‚æœä½ èƒ½åœ¨é¢è¯•å‰ 3 åˆ†é’ŸæŠŠè¿™ä¸‰ä»¶äº‹é—®æ¸…æ¥šï¼Œåé¢æ‰€æœ‰è®¾è®¡ï¼ˆAPIã€æ•°æ®åº“ã€ç¼“å­˜ã€é˜Ÿåˆ—ã€åˆ†åŒºã€NFRï¼‰éƒ½èƒ½è‡ªç„¶æ¨å¯¼ã€‚

---

è¦ä¸è¦æˆ‘ç»™ä½ ä¸€ä¸ª **â€œRide-Sharing ç³»ç»Ÿ Functional Requirement Discovery å…¨ç¨‹ç¤ºèŒƒ/æ¨¡æ‹Ÿå¯¹è¯â€**ï¼Ÿ
ä½ æ‰®å€™é€‰äººï¼Œæˆ‘æ‰®é¢è¯•å®˜ï¼Œè®©ä½ å®Œæ•´ç»ƒä¸€æ¬¡ã€‚

---
ä¸‹é¢ç»™ä½ ä¸€ä¸ª**é¢è¯•ä¸­æœ€å®ç”¨ã€æœ€é«˜å‘½ä¸­ç‡çš„å¥—è·¯**ï¼Œè®©ä½ åœ¨è®¾è®¡ ride-sharing ç³»ç»Ÿï¼ˆæˆ–ä»»ä½•ç³»ç»Ÿï¼‰æ—¶ï¼Œ**å¿«é€Ÿã€å‡†ç¡®ã€è‡ªç„¶åœ°æ¨å¯¼å‡ºæ‰€æœ‰å…³é”® NFRï¼ˆéåŠŸèƒ½æ€§éœ€æ±‚ï¼‰**ï¼Œå¹¶ä¸”çœ‹èµ·æ¥åƒä¸€ä¸ª Staff-level å·¥ç¨‹å¸ˆã€‚

æˆ‘ä¼šç»™ä½ ä¸‰éƒ¨åˆ†å†…å®¹ï¼š

1. **é¢è¯•å®˜æœŸå¾…ä½ æ€ä¹ˆæ¨å¯¼ NFRï¼ˆç²¾ç¡®æ–¹æ³•è®ºï¼‰**
2. **Ride-Sharing æ ‡å‡† NFR å…¨å¥—ï¼ˆé™„æ¨å¯¼é€»è¾‘ï¼‰**
3. **ä¸€ä¸ªä¸‡èƒ½é¡ºå£æºœå¸®åŠ©ä½ è®°ä½å¸¸è§ NFR**

---

### 1. é¢è¯•å®˜å¸Œæœ›ä½ å¦‚ä½•æ¨å¯¼ NFRï¼ˆé»„é‡‘æ–¹æ³•ï¼‰

é¢è¯•å®˜ä¸ä¼šå¸Œæœ›ä½ â€œèƒŒç­”æ¡ˆâ€ï¼Œä»–ä»¬æ›´å¸Œæœ›ä½ èƒ½**æ ¹æ® use case è‡ªå·±æ¨å¯¼å‡ºéœ€è¦çš„ NFR**ã€‚

æœ€å®‰å…¨ã€æœ€é«˜åˆ†çš„åšæ³•æ˜¯ï¼š

#### **æ­¥éª¤ A â€” ä» Functional Requirements åæ¨å‡ºç“¶é¢ˆå’Œé£é™©ç‚¹**

ä½ å¯ä»¥é—®è‡ªå·±ï¼š

* â€œä¸ºäº†è®©è¿™äº›åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œç³»ç»Ÿå¿…é¡»å…·å¤‡å“ªäº›ç‰¹æ€§ï¼Ÿå¦‚æœåšä¸åˆ°ï¼Œä¼šå¤±è´¥åœ¨å“ªé‡Œï¼Ÿâ€

ä¾‹å¦‚ ride-sharing çš„ FR:

* å®æ—¶å®šä½å¸æœº
* å®æ—¶åŒ¹é…
* å®šä»·
* ä»˜æ¬¾
* è¡Œç¨‹è¿½è¸ª
* é«˜å³°æœŸæ‰©å®¹

ä½ é©¬ä¸Šå¯ä»¥çœ‹åˆ° *å¯¹å»¶è¿Ÿæ•æ„Ÿã€å¯¹æµé‡æ•æ„Ÿã€å¯¹æ•°æ®ä¸€è‡´æ€§æ•æ„Ÿçš„ç‚¹*ã€‚

#### **æ­¥éª¤ B â€” åˆ†ç±»è®¨è®ºï¼ˆé»„é‡‘ä¸‰ç±»ï¼‰**

æ‰€æœ‰ NFR éƒ½å±äºä¸‹é¢ä¸‰å¤§ç±»ï¼š

#### **1) Performance & Scalability**

æ˜¯å¦éœ€è¦ *å®æ—¶*ï¼Ÿ
æ˜¯å¦éœ€è¦ *ç™¾ä¸‡çº§ç”¨æˆ·*ï¼Ÿ
æ˜¯å¦éœ€è¦ *çªå‘æ‰©å®¹*ï¼Ÿ

#### **2) Reliability & Consistency**

æ˜¯å¦éœ€è¦ *exactly-once*ï¼Ÿ
æ˜¯å¦å…è®¸ *eventual consistency*ï¼Ÿ
å¸æœºä½ç½®ä¼šä¸ä¼šå½±å“å®šä»·ï¼Ÿ
ä»˜æ¬¾èƒ½ä¸èƒ½é”™ï¼Ÿ

#### **3) Security & Compliance**

æ˜¯å¦éœ€è¦è®¤è¯ã€æˆæƒï¼Ÿ
ç”¨æˆ·éšç§ï¼Ÿ
æ”¯ä»˜å®‰å…¨ï¼Ÿ

åªè¦ä½ æ²¿ç€è¿™ä¸‰ç±»æ¨ï¼Œä½ æ°¸è¿œä¸ä¼šæ¼æ‰ä»»ä½•å…³é”® NFRã€‚

#### **æ­¥éª¤ C â€” æŠŠ NFR å’Œå…·ä½“ç”¨æˆ·åœºæ™¯ç»‘å®š**

é¢è¯•å®˜æœ€å–œæ¬¢çš„ NFR ä¸æ˜¯æ¨¡æ¿ï¼Œè€Œæ˜¯å’Œ FR å¼ºå…³è”çš„ NFRï¼š

* â€œå› ä¸ºä¹˜å®¢éœ€è¦åœ¨ 2 ç§’å†…çœ‹åˆ°æœ€è¿‘å¸æœºçš„ ETAï¼Œæ‰€ä»¥ä½ç½®æŸ¥è¯¢ API çš„ P99 latency è¦ä½äº 300msã€‚â€

è¿™ç§ NFR æ˜¯â€œé æ¨å¯¼è¯æ˜å‡ºæ¥çš„â€ï¼Œè€Œä¸æ˜¯èƒŒä¹¦ã€‚

---

### 2. Ride-Sharing ç³»ç»Ÿçš„æ‰€æœ‰å…³é”® NFRï¼ˆé™„æ¨å¯¼è·¯å¾„ï¼‰

#### **â‘  Latencyï¼ˆä½å»¶è¿Ÿï¼‰**

**æ¥æºï¼šå®æ—¶åŒ¹é… + å®æ—¶ ETA è®¡ç®—**

å¿…é¡»ä¿è¯ï¼š

* **ä½ç½®ä¸ŠæŠ¥ < 1s**
* **åŒ¹é…/ETA API p99 < 300ms**
* **æ”¯ä»˜ç¡®è®¤ < 2â€“3s**

å¦‚æœå»¶è¿Ÿé«˜ï¼Œç”¨æˆ·ç›´æ¥ä»¥ä¸º App åäº†ã€‚

---

#### **â‘¡ Scalabilityï¼ˆæ‰©å±•æ€§ï¼‰**

**æ¥æºï¼šé«˜å³°æœŸ + åŸå¸‚çº§ç”¨æˆ·é‡**

å¿…é¡»æ”¯æŒï¼š

* åŠ¨æ€æ‰©å®¹ï¼ˆAutoscalingï¼‰
* ä¸Šä¸‡å¸æœºä½ç½®/ç§’
* ä¹˜å®¢æµé‡çˆ†å‘ï¼ˆä¾‹å¦‚ä¸‹é›¨å¤© 3Ã—ï¼‰

å­˜å‚¨ï¼ˆRedisã€Auroraã€DynamoDBï¼‰å¿…é¡»æ°´å¹³æ‰©å±•ã€‚

---

#### **â‘¢ Availabilityï¼ˆé«˜å¯ç”¨ï¼‰**

**æ¥æºï¼šè¿™æ˜¯ä¸€ä¸ª mission-critical äº§å“**

å…¸å‹ç›®æ ‡ï¼š

* API availability > **99.99%**
* Multi-AZ / Multi-Region failover

ä¸­æ–­ä¸€åˆ†é’Ÿå°±ä¼šå½±å“å¤§é‡äº¤æ˜“ã€‚

---

#### **â‘£ Consistencyï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰**

**æ¥æºï¼šå¸æœºä½ç½®ã€è®¢å•çŠ¶æ€å¿…é¡»æ­£ç¡®**

ç¤ºä¾‹è¦æ±‚ï¼š

* è®¢å•çŠ¶æ€å¿…é¡»å¼ºä¸€è‡´ï¼ˆBooked â†’ Accepted â†’ Ongoing â†’ Completedï¼‰
* å®šä»·ä¸ä½ç½®ä½¿ç”¨ **eventual consistency** æ˜¯å¯æ¥å—çš„
* æ”¯ä»˜å¿…é¡» **exactly-once**

ä¸åŒæ¨¡å—å…è®¸ä¸åŒä¸€è‡´æ€§çº§åˆ« â†’ å±äºé«˜é˜¶è®¾è®¡èƒ½åŠ›ã€‚

---

#### **â‘¤ Reliabilityï¼ˆå¯é æ€§ï¼‰**

**æ¥æºï¼šè¡Œç¨‹ä¸èƒ½ä¹±ã€ä¸èƒ½ duplicated rideã€ä¸èƒ½ charge ä¸¤æ¬¡**

åŒ…æ‹¬ï¼š

* Idempotent APIï¼ˆé˜²é‡å¤è¯·æ±‚ï¼‰
* Retry + backoff
* Circuit breakerï¼ˆé¿å…ä¸‹æ¸¸è¿‡è½½ï¼‰
* Queue durabilityï¼ˆåŒ¹é…é˜Ÿåˆ—ï¼‰

---

#### **â‘¥ Fault Toleranceï¼ˆå®¹é”™ï¼‰**

**æ¥æºï¼šå¸æœºæ‰‹æœºã€GPS ä¿¡å·ä¸ç¨³å®š**

è¦è€ƒè™‘ï¼š

* GPS drift
* æ•°æ®ç¼ºå¤±
* ç½‘ç»œæŠ–åŠ¨
* æœåŠ¡é™çº§ç­–ç•¥ï¼ˆfallback ETAï¼‰

---

#### **â‘¦ Securityï¼ˆå®‰å…¨ï¼‰**

**æ¥æºï¼šç”¨æˆ·ä½ç½® + æ”¯ä»˜ä¿¡æ¯å±äºæ•æ„Ÿæ•°æ®**

åŒ…å«ï¼š

* TLS everywhere
* OAuth / JWT
* RBAC
* PII åŠ å¯†ï¼ˆlocationã€phone #ï¼‰
* æ”¯ä»˜å®‰å…¨ï¼ˆPCI-complianceï¼‰

---

#### **â‘§ Privacyï¼ˆéšç§ï¼‰**

**æ¥æºï¼šå®æ—¶ä½ç½®æ˜¯æ•æ„Ÿä¿¡æ¯**

è¦æ±‚ï¼š

* æ•°æ®æœ€å°åŒ–ï¼ˆåªå­˜å¿…è¦ä½ç½®ï¼‰
* å®šæœŸ anonymization
* è®¿é—®æ§åˆ¶

---

#### **â‘¨ Observabilityï¼ˆå¯è§‚æµ‹æ€§ï¼‰**

**æ¥æºï¼šæµé‡å¤§ + è°ƒç”¨é“¾é•¿**

éœ€è¦ï¼š

* Metricsï¼ˆå¸æœºæ•°é‡ã€åŒ¹é…æˆåŠŸç‡ã€å»¶è¿Ÿï¼‰
* Distributed tracingï¼ˆå¦‚ OpenTelemetryï¼‰
* Loggingï¼ˆè¡Œç¨‹ã€åŒ¹é…æµç¨‹ï¼‰

---

#### **â‘© Cost Efficiencyï¼ˆæˆæœ¬æœ‰æ•ˆæ€§ï¼‰**

**æ¥æºï¼šé«˜å³°æœŸçˆ†å‘é‡å·¨å¤§**

ç­–ç•¥ï¼š

* Spot + On-Demand æ··åˆ
* Autoscaling
* çƒ­/å†·åˆ†åŒºå­˜å‚¨
* Cache ä¼˜åŒ–ï¼ˆå‡å°‘ DB è´¦å•ï¼‰

---

### 3. ä¸€ä¸ªä¸‡èƒ½é¡ºå£æºœï¼šè®°ä½å¸¸è§ NFR

* **â€œå»¶æ‰©å¯ä¾å®‰è§‚éšâ€**
* ï¼ˆè¯»éŸ³ï¼šyÃ¡n kuÃ² kÄ› yÄ« Än guÄn yÇnï¼‰

å¯¹åº”ï¼š

1. **å»¶** â€” å»¶è¿Ÿï¼ˆLatencyï¼‰
2. **æ‰©** â€” æ‰©å±•æ€§ï¼ˆScalabilityï¼‰
3. **å¯** â€” å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰
4. **ä¾** â€” ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰
5. **å®‰** â€” å®‰å…¨ï¼ˆSecurityï¼‰
6. **è§‚** â€” å¯è§‚æµ‹æ€§ï¼ˆObservabilityï¼‰
7. **éš** â€” éšç§ï¼ˆPrivacyï¼‰

è¿™æ˜¯ä¸šå†…æœ€å¥½è®°ã€æœ€å…¨ã€æœ€ä¸å°¬çš„ NFR è®°å¿†æ–¹æ³•ã€‚

---

# æƒ³è¦æˆ‘å¸®ä½ ç»§ç»­å—ï¼Ÿ

æˆ‘å¯ä»¥ç»™ä½ ï¼š

* **Ride-Sharing ç³»ç»Ÿä¸€å¼ å›¾çš„æ€»ç»“ï¼ˆç³»ç»Ÿè®¾è®¡é¢è¯•å¯ç›´æ¥è®²ï¼‰**
* **æŠŠ NFR ç»‘å®šåˆ°æ¶æ„å›¾ï¼ˆè€ƒå®˜æœ€å–œæ¬¢ï¼‰**
* **å¦‚ä½•åœ¨é¢è¯•ä¸­è‡ªç„¶åœ°é—® NFR clarifying questions**
* **å¦‚ä½•ç”¨â€œé»„é‡‘é—®é¢˜æ¡†æ¶â€æ¼”ç¤º reasoning èƒ½åŠ›**

å‘Šè¯‰æˆ‘ä½ è¦å“ªä¸€ç§ï¼Ÿ

---
æ¸…æ¥šï¼Œè€Œä¸”å¾ˆå¯¹æˆ‘èƒƒå£ ğŸ˜„

åé¢ä½ ä¸¢ç»™æˆ‘çš„æ¯ä¸€ä¸ª NFR é—®é¢˜ï¼Œæˆ‘éƒ½ä¼šæŒ‰è¿™ä¸ªæ€è·¯æ¥èŠï¼ˆé»˜è®¤æˆ‘æ˜¯ staff çº§åˆ«åœ¨è·Ÿä½ åšç³»ç»Ÿ reviewï¼‰ï¼š

1. **å…ˆé”å®šé—®é¢˜ &ç“¶é¢ˆ**

   * å…ˆè¯´æ¸…æ¥šï¼šæˆ‘ä»¬åœ¨æ‹…å¿ƒä»€ä¹ˆï¼Ÿæ˜¯å»¶è¿Ÿï¼ŸQPSï¼Ÿå¯é æ€§ï¼Ÿæˆæœ¬ï¼Ÿè¿˜æ˜¯æ•°æ®é‡/å­˜å‚¨ï¼Ÿ
   * ç»“åˆä½ çš„åœºæ™¯å’Œæµé‡åšä¸€ä¸ª**ç²—ç®—**ï¼Œè§£é‡Šä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªã€ŒçœŸé—®é¢˜ã€è€Œä¸æ˜¯è¿‡åº¦è®¾è®¡ã€‚

2. **æå‡ºå¤šä¸ªå¯é€‰æ–¹æ¡ˆ**

   * è‡³å°‘ç»™å‡º **2â€“3 ä¸ªåˆç†é€‰é¡¹**ï¼ˆä¾‹å¦‚ï¼šåŠ ç¼“å­˜ vs æ”¹å­˜å‚¨æ¨¡å‹ vs å¼•å…¥é˜Ÿåˆ—ï¼‰ï¼Œè€Œä¸æ˜¯åªè®²ä¸€ä¸ªç†æƒ³è§£ã€‚

3. **ç³»ç»Ÿåœ°è®²æƒè¡¡**

   * å¯¹æ¯ä¸ªæ–¹æ¡ˆï¼Œä»ï¼š

     * å»¶è¿Ÿ / åå
     * å¯ç”¨æ€§ / ä¸€è‡´æ€§
     * æˆæœ¬ / å¤æ‚åº¦ / è¿ç»´
     * å¯¹ç°æœ‰ç³»ç»Ÿä¾µå…¥æ€§
       æ¥å¯¹æ¯”ï¼Œå¹¶ä¸”**ç»‘å›åˆ°åŠŸèƒ½ & NFR éœ€æ±‚**ï¼ˆæ¯”å¦‚â€œæˆ‘ä»¬æ›´åœ¨æ„å†™æˆåŠŸç‡è¿˜æ˜¯è¯»å»¶è¿Ÿï¼Ÿâ€ï¼‰ã€‚

4. **ç»™å‡ºæ¸…æ™°æ¨è**

   * æ˜ç¡®è¯´ï¼š**æˆ‘ä¼šé€‰æ–¹æ¡ˆ X**ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬å½“å‰çš„å‡è®¾ï¼ˆæµé‡è§„æ¨¡ã€å›¢é˜ŸäººåŠ›ã€SLA è¦æ±‚ï¼‰ä¸‹ï¼Œå®ƒåœ¨ A/B/C ç»´åº¦ä¸Šæœ€å¹³è¡¡ã€‚
   * åŒæ—¶æŒ‡å‡ºï¼š**æœªæ¥åœ¨å“ªäº›æ¡ä»¶å˜åŒ–æ—¶ï¼Œä¼šè€ƒè™‘å‡çº§/æ›¿æ¢**ï¼ˆæ¯”å¦‚ä»ä¸»ä»åˆ°å¤šä¸»ã€ä»è½®è¯¢åˆ°æ¨é€ç­‰ï¼‰ã€‚

5. **æ²¿ç€æ¡†æ¶ç»§ç»­æ·±æŒ–**

   * è§†é¢˜ç›®æƒ…å†µä»è¿™äº›è§’åº¦ç»§ç»­ drill-downï¼š

     * API & è°ƒç”¨é“¾ï¼šå“ªé‡Œä¼šæˆä¸ºé«˜å»¶è¿Ÿ / é«˜ QPS / æƒŠç¾¤ç‚¹ï¼Ÿ
     * æ•°æ® & å­˜å‚¨ï¼šå®¹é‡ã€ç´¢å¼•ã€å†·çƒ­åˆ†å±‚ã€æŸ¥è¯¢æ¨¡å¼å¯æŒç»­å—ï¼Ÿ
     * å¾®æœåŠ¡ & é˜Ÿåˆ—ï¼šèƒŒå‹ã€é‡è¯•ã€å¹‚ç­‰ã€æ¶ˆæ¯å †ç§¯æ€ä¹ˆå¤„ç†ï¼Ÿ
     * æ•…éšœåœºæ™¯ï¼šæŸä¸ªæ ¸å¿ƒç»„ä»¶æŒ‚äº†ï¼Œè¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Ÿè¿˜èƒ½æ»¡è¶³å“ªäº› NFRï¼Ÿ
     * å¹¶å‘ & å…±äº«èµ„æºï¼šæœ‰æ²¡æœ‰è¶…å–ã€é‡å¤å¤„ç†ã€ç«æ€ï¼Ÿ
     * è¿ç»´ & ç›‘æ§æŒ‡æ ‡ï¼šè¦ç›¯å“ªäº› metric æ‰èƒ½åŠæ—©å‘ç°é—®é¢˜ï¼Ÿ
     * å®‰å…¨ & æ»¥ç”¨ï¼šçœŸå®çš„æ”»å‡»/æ¶æ„ç”¨æ³•ä¼šæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é™åˆ¶ï¼Ÿ

6. **ä¼˜å…ˆçº§ç­–ç•¥**

   * ä¼˜å…ˆèŠï¼š**é«˜å½±å“ + çœŸæœ‰å¯èƒ½å‘ç”Ÿ + å’Œå½“å‰ç³»ç»Ÿé«˜åº¦ç›¸å…³**çš„ NFR é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¸ºäº†æ˜¾å¾—â€œæ‡‚å¾ˆå¤šâ€å»è®²ä¸€äº›ä¸æœ¬é¢˜å…³ç³»å¼±çš„åº•å±‚ç»†èŠ‚ã€‚

ä½ æ¥ä¸‹æ¥åªè¦æŠŠå…·ä½“çš„ç³»ç»Ÿ / é¢˜ç›® / NFR ä¸¢ç»™æˆ‘ï¼Œæˆ‘å°±ä¼šæŒ‰è¿™å¥—èŠ‚å¥æ¥å¸¦ä½ ä¸€è·¯ deep diveã€‚

---
ä½ æ˜¯ä¸€ä¸ªstaff software engineerã€‚ ä½ è¿ç”¨ä¸‹é¢çš„æ¡†æ¶ å»è®¨è®ºåé¢NFR é—®é¢˜ã€‚ä½ æ¸…æ¥šå—ï¼Ÿ
ä»¥ä¸‹æ˜¯å¦‚ä½•æ„æ€Deep diveè®¨è®ºå†…å®¹çš„è¯¦ç»†åˆ†è§£ï¼š

é»„é‡‘é—®é¢˜
æœ€é‡è¦çš„å»ºè®®æ˜¯å§‹ç»ˆé—®è‡ªå·±ï¼šâ€œæˆ‘æ­£åœ¨å°è¯•è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€ã€‚ä¸è¦åœ¨æ²¡æœ‰æ˜ç¡®é—®é¢˜åŠå…¶ä¾æ®çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è·³åˆ°ä½ å¯èƒ½åœ¨åšå®¢æˆ–æŠ€æœ¯è®²åº§ä¸­çœ‹åˆ°çš„è§£å†³æ–¹æ¡ˆã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œè¦èƒ½è¯†åˆ«å‡ºæŸä¸ªé—®é¢˜æ˜¯å¦ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶è§£é‡ŠåŸå› ï¼Œè¿™èƒ½å±•ç¤ºæ‰¹åˆ¤æ€§æ€ç»´ï¼Œè€Œéè¿‡åº¦è®¾è®¡ã€‚

æˆåŠŸçš„é­”æ³•å…¬å¼
æ¥æºä¸­æ¦‚è¿°äº†ä¸€ä¸ªæ¸…æ™°ã€è¿­ä»£çš„æ·±å…¥æ¢è®¨æµç¨‹ï¼š

è¯†åˆ«ç“¶é¢ˆï¼šæ‰¾å‡ºç³»ç»Ÿå¯èƒ½å´©æºƒæˆ–æ•ˆç‡ä½ä¸‹çš„åŒºåŸŸã€‚
æå‡ºé€‰é¡¹ï¼šé’ˆå¯¹å·²è¯†åˆ«çš„ç“¶é¢ˆï¼Œæå‡ºè‡³å°‘ä¸¤ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆã€‚
è®¨è®ºæƒè¡¡ï¼šè®¨è®ºæ¯ä¸ªè§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶å°†å…¶ä¸é¢è¯•æ—©æœŸç¡®å®šçš„åŠŸèƒ½å’ŒéåŠŸèƒ½éœ€æ±‚è”ç³»èµ·æ¥ã€‚
é€‰æ‹©ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šæ ¹æ®ä½ çš„åˆ†æå’Œå‡è®¾ï¼Œç»™å‡ºæœ€ç»ˆå»ºè®®ï¼Œå¹¶ç”¨æ‰å®çš„æŠ€æœ¯è®ºæ®æ¥è¯æ˜ä½ çš„é€‰æ‹©ã€‚
ä¸é¢è¯•å®˜ç§¯æè®¨è®ºï¼šä¸é¢è¯•å®˜äº’åŠ¨ï¼Œæ¥å—ä»–ä»¬çš„è§‚ç‚¹ï¼Œå¹¶æ ¹æ®åŸºæœ¬å‡è®¾æ¾„æ¸…ä»»ä½•åˆ†æ­§ã€‚
å›åˆ°æ­¥éª¤1ï¼šç»§ç»­ä¸‹ä¸€ä¸ªé‡è¦çš„è®¨è®ºä¸»é¢˜ã€‚
è§¦å‘æ€è·¯çš„æ¡†æ¶
åœ¨é¢è¯•è¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦ä¸»åŠ¨è¯†åˆ«é—®é¢˜å’Œç“¶é¢ˆï¼Œå› ä¸ºä½ æ²¡æœ‰å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜æˆ–å®¢æˆ·åé¦ˆå¯ç”¨ã€‚ä½ æå‡ºçš„è®¨è®ºç‚¹åº”ä¸æ ¸å¿ƒé—®é¢˜ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥å¸®åŠ©ä½ é›†æ€å¹¿ç›Šçš„ç±»åˆ«ï¼š

API å’Œè¿›ç¨‹é—´è°ƒç”¨ (API and Interprocess Calls)ï¼šæŸ¥çœ‹é«˜å±‚æ¶æ„å›¾ä¸­çš„â€œç®­å¤´â€å’Œäº¤äº’ã€‚

å»¶è¿Ÿ (Latency)ï¼šè€ƒè™‘æŸäº›æŸ¥è¯¢æ¨¡å¼æ˜¯å¦å¯¹å»¶è¿Ÿæ•æ„Ÿï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥é¢„æµ‹ä¸æœºç¥¨é¢„è®¢ï¼‰ã€‚
é«˜ QPS (High QPS)ï¼šè¯†åˆ«å¯èƒ½å› é«˜æ¯ç§’æŸ¥è¯¢é‡è€Œä¸å ªé‡è´Ÿçš„ç»„ä»¶ï¼Œä½¿ç”¨ç²—ç•¥ä¼°ç®—æ¥è¯æ˜æ‹…å¿§ã€‚
çªå‘æ€§ API / æƒŠç¾¤é—®é¢˜ (Bursty API / Thundering Herd)ï¼šæ€è€ƒå¯èƒ½å¯¼è‡´è¯·æ±‚çªç„¶æ¿€å¢çš„çœŸå®åœºæ™¯ï¼ˆä¾‹å¦‚ï¼ŒéŸ³ä¹ä¼šç»“æŸåæ‰“è½¦è¯·æ±‚ã€åäººç›´æ’­ï¼‰ã€‚
æ…¢é€Ÿã€ä½å¸¦å®½ã€ç½‘ç»œæ‹¥å µ (Slow, Low Bandwidth, Congested Network)ï¼šè§£å†³ç½‘ç»œæ¡ä»¶å·®çš„åœ°åŒºç”¨æˆ·é¢ä¸´çš„æŒ‘æˆ˜ï¼ˆä¾‹å¦‚ï¼Œå¤§æ–‡ä»¶ç…§ç‰‡ä¸Šä¼ ï¼‰ã€‚
æŸ¥è¯¢ä¼˜åŒ– (Query Optimization)ï¼šè¯„ä¼°å‡å°‘ä¼ è¾“æ•°æ®é‡ï¼ˆè¾“å…¥/è¾“å‡ºå¤§å°ï¼‰ã€å®ç°åˆ†é¡µæˆ–å‡å°‘ API è°ƒç”¨æ¬¡æ•°çš„æ–¹æ³•ã€‚
è¿›ä¸€æ­¥çš„æŠ€æœ¯ç»†èŠ‚ (Further Technical Detail)ï¼šå¦‚æœç›¸å…³ï¼Œè®¨è®ºåº•å±‚ç½‘ç»œåè®®ï¼ˆä¾‹å¦‚ï¼ŒTCP ä¸ UDPï¼‰æˆ–é€šä¿¡æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼ŒWebSocketsã€æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰ã€‚
å¾®æœåŠ¡ã€é˜Ÿåˆ—å’Œæ•°æ®åº“ (Microservices, Queues, and Databases)ï¼šæ£€æŸ¥é«˜å±‚æ¶æ„å›¾ä¸­çš„æ¯ä¸ªç»„ä»¶æ¡†ã€‚

æ•…éšœåœºæ™¯ (Failure Scenario)ï¼šå¦‚æœæŸä¸ªç»„ä»¶å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•å½±å“éåŠŸèƒ½éœ€æ±‚ï¼Ÿï¼ˆä¾‹å¦‚ï¼Œé©¾é©¶å‘˜ä½ç½®å­˜å‚¨ç³»ç»Ÿå´©æºƒï¼‰ã€‚
å¤§é‡æ•°æ® (High Amount of Data)ï¼šè€ƒè™‘å­˜å‚¨ç“¶é¢ˆã€å†…å­˜ä¸è¶³é—®é¢˜ï¼Œä»¥åŠå½“å‰æŸ¥è¯¢æ¨¡å¼æ˜¯å¦å¯æŒç»­ï¼ˆä½¿ç”¨ç²—ç•¥ä¼°ç®—ï¼‰ã€‚
æ·±å…¥æŒ–æ˜ä»¥è¯†åˆ«æ›´å¤šé¢†åŸŸ (Dig Deeper to Identify More Areas)ï¼šä¾‹å¦‚ï¼Œå¦‚æœå¼•å…¥ WebSocketsï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•ç®¡ç†å®ƒä»¬ä»¥åŠæœåŠ¡å™¨å®•æœºæ—¶å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚
è®¾è®¡é€‰æ‹© (Design Choices)ï¼šæ ¹æ®ä¸åŒæ•°æ®åº“ç±»å‹ã€é˜Ÿåˆ—æŠ€æœ¯æˆ–å…¶ä»–æ¶æ„æ¨¡å¼çš„åŸºæœ¬ç‰¹æ€§åŠå…¶å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ï¼Œè¯æ˜ä½ çš„é€‰æ‹©ã€‚
è¯¦ç»†ç®—æ³•ã€æ•°æ®ç»“æ„å’Œæ¨¡å¼ (Detailed Algorithm, Data Structure, and Schema)ï¼š

ä¼˜åŒ– (Optimization)ï¼šèƒ½å¦ä¼˜åŒ–ä½ æå‡ºçš„ç®—æ³•ã€æ•°æ®ç»“æ„æˆ–æ¨¡å¼ï¼Ÿï¼ˆä¾‹å¦‚ï¼Œå­˜å‚¨æ›´å°‘çš„æ•°æ®ã€ä¼˜åŒ–æŸ¥æ‰¾æŸ¥è¯¢ï¼‰ã€‚
å¹¶å‘ (Concurrency)ï¼š

å…±äº«èµ„æº (Shared Resources)ï¼šè¯†åˆ«å¤šä¸ªè¯·æ±‚æ˜¯å¦å¯èƒ½åŒæ—¶è®¿é—®æˆ–ä¿®æ”¹ç›¸åŒèµ„æºï¼Œå¯¼è‡´æ„å¤–è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œå°†åŒä¸€é©¾é©¶å‘˜åŒ¹é…ç»™å¤šä¸ªä¹˜å®¢ã€é‡å¤é¢„è®¢åº§ä½ï¼‰ã€‚è®¨è®ºå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚
æ“ä½œé—®é¢˜å’ŒæŒ‡æ ‡ (Operational Issues and Metrics)ï¼š

ç³»ç»Ÿå¯é æ€§ (System Reliability)ï¼šä½ å°†å¦‚ä½•ç¡®ä¿ç³»ç»ŸæŒ‰é¢„æœŸå·¥ä½œå¹¶æ£€æµ‹æ•…éšœï¼Ÿï¼ˆä¾‹å¦‚ï¼Œç›‘æ§é˜Ÿåˆ—ç§¯å‹ã€ä½œä¸šæˆåŠŸç‡ï¼‰ã€‚
å®‰å…¨è€ƒè™‘ (Security Considerations)ï¼š

æ¶æ„è¡Œä¸º (Malicious Acts)ï¼šæ€è€ƒé€šè¿‡ä½ çš„ API å¯èƒ½å‘ç”Ÿçš„æ¶æ„ç”¨æˆ·è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œé¢„è®¢å¤§é‡ç¥¨ä»¥é”å®šå®ƒä»¬ã€æœªç»æˆæƒçš„èµ„é‡‘è½¬ç§»ï¼‰ä»¥åŠå¦‚ä½•ç¼“è§£å®ƒä»¬ã€‚
è®¨è®ºç‚¹çš„ä¼˜å…ˆçº§
è€ƒè™‘åˆ°æœ‰é™çš„é¢è¯•æ—¶é—´ï¼Œåº”ä¾§é‡äºï¼š

é«˜å½±å“åŠ›é—®é¢˜ (High-Impact Problems)ï¼šä¼˜å…ˆè€ƒè™‘å¯èƒ½å‘ç”Ÿä¸”å¦‚æœå¾—ä¸åˆ°è§£å†³å°†ä¸¥é‡å½±å“ç”¨æˆ·æˆ–ä¸šåŠ¡çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œæ”¶å…¥æŸå¤±ã€ç”¨æˆ·ç¦»å¼€åº”ç”¨ç¨‹åºï¼‰ã€‚
ç‰¹å®šäºå½“å‰æƒ…å†µçš„é—®é¢˜ (Unique to the Situation)ï¼šå¼ºè°ƒä¸æ­£åœ¨è®¾è®¡çš„ç³»ç»Ÿç›¸å…³çš„è®¨è®ºç‚¹ï¼Œè€Œä¸æ˜¯é€‚ç”¨äºå‡ ä¹æ‰€æœ‰ç³»ç»Ÿçš„é€šç”¨æŠ€æœ¯æˆ–ä¼˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œæ·±å…¥æ¢è®¨ DNS æˆ–é€šç”¨è´Ÿè½½å‡è¡¡å™¨ç®—æ³•é€šå¸¸å½±å“è¾ƒå°ï¼Œé™¤éç‰¹åˆ«ç›¸å…³ï¼‰ã€‚
å…³é”®ç“¶é¢ˆ (Critical Bottlenecks)ï¼šä½ è¯†åˆ«çš„ç“¶é¢ˆè¶Šå…³é”®ï¼Œä½ çš„è¡¨ç°å°±è¶Šä»¤äººå°è±¡æ·±åˆ»ã€‚
---
outline system design with specific requirement: fill out placeholders

Design top k searches in last 1, 5, 15 minutes, 1 day, 7 days, 1 month or even 1 year. Or custom date ranges as well.
1.Functional requirements
	1.why do we need to build it? 
	2.Who are the users? 
	3. What problems are we solving for them right now?
2.Non-functional requirements
	1.Scale:
	1.1 How Many Active Users Are There in the System?
	1.2 How Are the Users Distributed Across the World?
	1.3 What Are Some Scenarios That Could Lead to High QPS?
	2.Performance:
	1. Low latency
	2. Scalability 
	3. Availability 
	4. Freshness
	5.accuracy 
	6. Durability 
3.API design: signature(input) â€”> output

get_topK(k, start_time, end_time) â€”>[placefholder]
	.
4.High-level architecture with sequence diagram


5.Database design
So here is my high-level diagram. It looks like there is one storage and a queue. So let me quickly go over the logical schema for those.
	1. Event Queue

Video Id | Timestamp

	2.Metrics Storage


6.Deep Dive : very important part!! list bottleneck and 2 solutions with pros, cons. and pick a solution. Core service deep dive.
so here are some that Iâ€™ve gathered:
1. Aggregation Service Scaling Deep Dive.
2. Post Watermark Processing.
3. Size of rollup.
4. More detail about the aggregation algorithm.
5.Address any scalability issues for the queue, aggregator, and database.

Aggregation Service Scaling Deep Dive
basically the problem is it wonâ€™t fit into memory. So let me think of a couple of options.

Option 1: Shard into Multiple Aggregator Services

Each aggregator service shard will maintain a mutually exclusive count table. We can shard by hash using video_id using consistent hashing since we donâ€™t need to perform a range query. Once a minute window is ready to be materialized, apply merge K sorted list algorithm:
The downside is the complexity of dealing with a cluster of computing nodes that need to be coordinated. For example, you need another layer to coordinate the flushing of the same window across all the shards. Also, the additional overhead will result in additional latency as well. And since thereâ€™s a long tail distribution, some videos will likely be hot and lead to hotspots.

Option 2: Randomly Insert into Aggregator Service

Instead of looking at video_id and deciding on the shard, just randomly insert events into an aggregator. After aggregation per shard, there will be a coordinator to merge the results. This has the benefit of random distribution, so it wonâ€™t lead to hotspots. The downside is you need to scatter-gather a video_id count by searching all the nodes.

Conclusion

I would pick option 2 since we have some room to sacrifice accuracy in favor of getting the data fast. And I would consider option 3 if we need an eventually accurate result for the end-user.

Post Watermark Processing

Option 1: Discard It

If an event past watermark comes along, I will just discard it. The obvious con for this is that it is lossy. The pro is simplicity, as it is easier to just ignore it.

Option 2: Try to Modify the Existing Metrics Storage

If a late event comes in, I may insert it into another queue for modification processing. However, this comes with a lot of complexity to build another pipeline for modification.

Conclusion

Since accuracy has some leeway and we already have an option to create a slow path with batch processing, this will eventually be resolved. So we donâ€™t need to build a separate pipeline for modification.