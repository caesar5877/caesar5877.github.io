好的，关于系统设计面试中如何收集需求，以下是根据资料的详细解释：

在系统设计面试中，收集需求是整个设计框架的**第一步**，并且被认为是至关重要的，尤其是在45分钟的短面试中。

### 需求收集的目的 (Purpose of Requirement Gathering)
需求收集的目的是为了**测试你阐明开放式和模糊问题陈述的能力**。面试官想看你如何组织思路，专注于一组需求，并与他们确认系统的假设，以便在后续环节中能集中讨论这些内容。

### 功能需求 (Functional Requirements)
在收集功能需求阶段，你需要扮演一个产品经理的角色，**开发用户故事来解决用户的问题**。面试官会考察你扎实的产品意识和强大的用户同理心。

你应该思考以下两个核心问题：
1.  **这个产品是为谁而设计？我们为什么需要构建它？**
2.  **我们需要哪些功能来解决用户的问题？**

**正确做法与错误做法示例**
*   **错误做法 (Don't Do This)**：当被要求设计一个文件存储系统时，直接跳到“用户可以保存和查看文件”这样的功能点。这种方式没有说明用户为什么需要这些功能。
*   **正确做法 (Do This)**：询问“我们为什么要构建文件存储？我们正在尝试解决什么客户问题？”。当面试官回答用户想将本地文件组织到云端并确保不丢失时，你可以提出“我们可以提供一个功能，让用户点击并拖放文件夹，然后我们将递归上传其中的文件和文件夹。我们会确保系统具有强大的**持久性**”。
    *   **分析**：后一种方法显示出更强的用户同理心，你提出功能是为了解决客户痛点，并且能利用产品理解来强调系统持久性的重要性。

**关键点**：
*   对于面向用户的产品，花一些时间勾勒用户界面（wireframe）设计是有价值的，因为仪表盘设计会影响你的API设计。
*   对于基础设施和后端问题，也要思考终端用户的体验（例如，爬虫的新鲜度对用户的重要性）。
*   提出几个功能后，将其**缩小到1到2个**，并征得面试官的同意。这能确保讨论的深度而非广度。
*   **澄清术语**：在确定1-2个核心功能后，花点时间深入澄清其含义（例如，推荐系统应该包含哪些推荐内容和排名算法）。

### 非功能需求 (Non-Functional Requirements)
在同意功能需求后，你需要**识别那些能让你的设计独特且具有挑战性的领域**。你应该通过提问来初步判断哪些地方可能导致系统崩溃，以及在系统出现瓶颈时，哪些领域可以进行权衡以实现扩展。

本节主要关注**规模 (Scale)** 和 **性能约束 (Performance Constraints)**。

#### 规模 (Scale)
*   **系统中有多少活跃用户？(How Many Active Users Are There in the System?)**
    *   此问题旨在了解系统的规模，并可用于粗略估算 (back-of-the-envelope calculations)。
*   **用户在全球如何分布？(How Are the Users Distributed Across the World?)**
    *   这对于讨论**地理本地化设计 (geo locality design)** 至关重要，因为跨地域通信的延迟会显著影响用户体验。
*   **哪些场景可能导致高 QPS (Queries Per Second)？(What Are Some Scenarios That Could Lead to High QPS?)**
    *   这展示你思考可能使系统崩溃的场景的能力，例如**突发性请求 (bursty situations)** 和 **惊群问题 (thundering herd problem)**。面试官希望你主动提出困难案例。
    *   **示例**：网约车服务在音乐会散场时、Facebook直播在热门事件时、电商在抢购时可能出现高QPS。
*   **哪些场景可能导致高存储和高带宽？(What Are Some Scenarios That Could Lead to High Storage and Bandwidth?)**
    *   这有助于确定是否需要扩展存储系统。考虑数据量、请求频率以及是否有“超级用户”上传大量数据（例如，照片存储中的大文件上传、Netflix的夜间流量高峰）。

#### 性能约束 (Performance Constraints)
*   **可用性 (Availability) 和一致性 (Consistency) 要求是什么？(What is the Availability and Consistency Requirement?)**
    *   讨论系统如何调整用户产品体验的一致性以更好地满足可用性需求。**重点应放在用户体验上**，而非直接选择AP或CP系统。
    *   **示例**：Facebook新闻源，讨论用户发布后内容延迟显示是否可接受，以优化可用性。
*   **准确性 (Accuracy) 要求是什么？(What Is the Accuracy Requirement?)**
    *   讨论系统是否可以牺牲准确性来更好地满足设计约束（例如，通知服务是否可以丢失一些消息，限流器是否可以近似正确）。
*   **响应时间 (Response Time) 和延迟 (Latency) 约束是什么？(What Is the Response Time and Latency Constraint?)**
    *   确定用户需要等待多久才能收到预期数据并仍能获得良好用户体验。不同应用有不同要求（例如，机票预订可接受几秒，Facebook新闻源P99要求500毫秒以内）。
    *   **提醒**：区分**响应时间** (Latency + Processing Time) 和 **延迟** (Latency)。
*   **新鲜度 (Freshness) 要求是什么？(What Is the Freshness Requirement?)**
    *   讨论数据陈旧性如何影响用户体验。新鲜度分为实时 (real-time)、近实时 (near real-time) 和批处理 (batch processing)。
    *   **示例**：股票交易需要实时，Facebook Live可接受几秒延迟，静态网站爬虫可接受几天更新。
*   **持久性 (Durability) 要求是什么？(What Is the Durability Requirement?)**
    *   讨论数据持久性如何影响用户体验。数据丢失对用户意味着什么？（例如，用户生活照片需要高持久性，网约车司机位置更新可以接受低持久性）。

通过以上步骤，你可以在面试的早期阶段，与面试官建立清晰的基线和假设，为后续的深入设计和讨论打下坚实的基础。